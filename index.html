<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Chúc mừng 20/10 — Gửi chị</title>
    <style>
        :root{--accent:#e43f6f;--bg1:#fff6fb;--bg2:#fff0f4}
        *{box-sizing:border-box;margin:0;padding:0}
        html,body{height:100%}
        body{
            font-family: "Segoe UI", Roboto, Arial, sans-serif;
            background: linear-gradient(180deg,var(--bg1),var(--bg2));
            overflow:hidden;
        }
        /* full-canvas bg */
        canvas#bgCanvas{position:fixed;inset:0;z-index:0;pointer-events:none}
        /* main stage */
        .stage{
            position:relative;z-index:10;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:36px;
            perspective:1200px;
        }
        .card{
            width:min(980px,95%);background:rgba(255,255,255,0.9);border-radius:20px;padding:28px;box-shadow:0 30px 80px rgba(196,72,110,.14);
            transform-style:preserve-3d;transition:transform .25s ease;backdrop-filter: blur(6px);
            position:relative;overflow:visible;
        }
        h1{color:var(--accent);font-size:30px;margin-bottom:8px;text-align:center}
        .sub{color:#6b3750;text-align:center;margin-bottom:18px}
        /* gift area */
        .gift-wrap{display:flex;align-items:center;justify-content:center;gap:18px;flex-direction:column}
        .gift{
            width:260px;height:260px;position:relative;cursor:pointer;transform-origin:center;transition:transform .35s cubic-bezier(.2,.9,.3,1)}
        .gift img{width:100%;height:100%;object-fit:contain;border-radius:14px;display:block;box-shadow:0 20px 50px rgba(228,63,111,.12)}
        .gift:active{transform:scale(.98)}
        /* letter that flies out */
        .letter{
            position:absolute;left:50%;top:20%;width:220px;transform:translate(-50%,0) scale(.6);opacity:0;z-index:8;
            transition:transform .9s cubic-bezier(.2,.9,.3,1),opacity .5s;
            pointer-events:none;
        }
        .letter.show{transform:translate(-50%,-220px) scale(1);opacity:1}
        /* action */
        .controls{display:flex;gap:12px;justify-content:center;margin-top:14px}
        .btn{background:var(--accent);color:#fff;border:0;padding:10px 16px;border-radius:10px;cursor:pointer;font-weight:600}
        /* note modal slide-in */
        .note{
            position:fixed;
            left:50%;
            top:50%;
            z-index:20;
            width:90%;
            max-width:560px;
            background:linear-gradient(180deg,#fff,#fff8fb);
            border-radius:14px;
            padding:18px;
            box-shadow:0 24px 60px rgba(24,8,24,.38);
            transform:translate(-50%,-50%) scale(.98);
            opacity:0;
            transition:transform .36s ease, opacity .36s ease;
            backdrop-filter: blur(4px);
        }
        .note.show{
            transform:translate(-50%,-50%) scale(1);
            opacity:1;
        }
        .note.show{transform:translateY(0) scale(1);opacity:1}
        .note-head{display:flex;gap:12px;align-items:center}
        .note-head img{width:64px;height:64px;object-fit:cover;border-radius:10px}
        .typed{margin-top:10px;white-space:pre-wrap;color:#532935;line-height:1.45}
        .typed::after{content:"";display:inline-block;width:10px;height:18px;background:url('./image/cursor.png') center/contain no-repeat;margin-left:6px;vertical-align:middle;animation:blink .9s steps(2) infinite}
        @keyframes blink{50%{opacity:0}}
        /* small floating confetti pieces (DOM) */
        .confetti{position:fixed;pointer-events:none;z-index:30;will-change:transform,opacity}
        /* corner animated gifs */
        .corner{position:fixed;bottom:12px;width:92px;opacity:.96;z-index:9}
        .corner.left{left:12px}
        .corner.right{right:12px;transform:scaleX(-1)}
        /* responsive */
        @media(max-width:600px){
            .note{right:12px;left:12px;width:auto}
            .note{ left:50%; top:50%; transform:translate(-50%,-50%) scale(1); width:calc(100% - 24px); max-width:none; }
            .gift{width:200px;height:200px}
        }
    </style>
</head>
<body>
    <canvas id="bgCanvas"></canvas>

    <div class="stage">
        <div class="card" id="card">
            <h1>Chúc mừng 20/10</h1>
            <div class="sub">Gửi chị yêu — Nhấn vào hộp quà để mở bất ngờ</div>

            <div class="gift-wrap">
                <div class="gift" id="gift">
                    <img src="./image/giftbox.png" alt="Hộp quà">
                </div>

                <img class="letter" id="letter" src="./image/letters.png" alt="Thư">
                <div class="controls">
                    <button class="btn" id="openBtn">Mở Quà</button>
                    <button class="btn" id="surpriseBtn" style="background:#7b2f4a">Gửi Lời Chúc</button>
                </div>
            </div>
        </div>
    </div>

    <div class="note" id="note" aria-hidden="true">
        <div class="note-head">
            <img src="./image/love1.jfif" alt="Ảnh">
            <div>
                <div style="color:var(--accent);font-weight:700">Gửi Chị Của Emm,</div>
                <small style="color:#8b5770">20/10 — Ngày Phụ nữ Việt Nam</small>
            </div>
        </div>
        <div class="typed" id="typed"></div>
    </div>

    <img class="corner left" src="./image/mewmew.gif" alt="" aria-hidden="true">
    <img class="corner right" src="./image/mewmew.gif" alt="" aria-hidden="true">

    <script>
        // Canvas background hearts particles
        const canvas = document.getElementById('bgCanvas');
        const ctx = canvas.getContext('2d');
        let W = canvas.width = innerWidth;
        let H = canvas.height = innerHeight;
        const heartImg = new Image();
        heartImg.src = './image/heart.png';

        const particles = [];
        function rand(min,max){ return Math.random()*(max-min)+min }
        function createParticle(){
            return {
                x: rand(0,W),
                y: H + rand(10,200),
                vx: rand(-0.4,0.4),
                vy: -rand(0.6,2.2),
                size: rand(10,34),
                rot: rand(0,Math.PI*2),
                drot: rand(-0.02,0.02),
                alpha: rand(0.5,0.98)
            };
        }
        for(let i=0;i<70;i++) particles.push(createParticle());

        function resize(){
            W = canvas.width = innerWidth;
            H = canvas.height = innerHeight;
        }
        addEventListener('resize', resize);

        function draw(){
            ctx.clearRect(0,0,W,H);
            particles.forEach(p=>{
                p.x += p.vx;
                p.y += p.vy;
                p.rot += p.drot;
                if(p.y < -50 || p.x < -60 || p.x > W+60){
                    Object.assign(p, createParticle());
                    p.y = H + rand(10,200);
                }
                ctx.save();
                ctx.globalAlpha = p.alpha*0.9;
                ctx.translate(p.x,p.y);
                ctx.rotate(p.rot);
                const s = p.size * (0.9 + 0.2*Math.sin(performance.now()/1000 + p.x));
                ctx.drawImage(heartImg, -s/2, -s/2, s, s);
                ctx.restore();
            });
            requestAnimationFrame(draw);
        }
        heartImg.onload = () => requestAnimationFrame(draw);

        // parallax card tilt
        const card = document.getElementById('card');
        window.addEventListener('mousemove', e=>{
            const cx = innerWidth/2, cy = innerHeight/2;
            const dx = (e.clientX - cx) / cx;
            const dy = (e.clientY - cy) / cy;
            card.style.transform = `rotateX(${(-dy*6).toFixed(2)}deg) rotateY(${(dx*6).toFixed(2)}deg) translateZ(0)`;
        });
        window.addEventListener('mouseleave', ()=> card.style.transform = '');

        // gift open & letter fly
        const gift = document.getElementById('gift');
        const letter = document.getElementById('letter');
        const openBtn = document.getElementById('openBtn');
        const surpriseBtn = document.getElementById('surpriseBtn');
        const note = document.getElementById('note');
        const typedEl = document.getElementById('typed');

        function burstConfetti(x = innerWidth/2, y = innerHeight/2, count=22){
            for(let i=0;i<count;i++){
                const d = document.createElement('div');
                d.className = 'confetti';
                d.style.left = (x - 8) + 'px';
                d.style.top = (y - 8) + 'px';
                d.style.width = d.style.height = (Math.random()*10+8)+'px';
                d.style.background = `hsl(${Math.random()*360},80%,60%)`;
                d.style.borderRadius = (Math.random()>0.6? '0' : '50%');
                document.body.appendChild(d);
                const vx = rand(-6,6), vy = rand(-12,-4), rot = rand(-720,720);
                d.animate([
                    { transform: `translate(0,0) rotate(0deg)`, opacity:1 },
                    { transform: `translate(${vx*30}px, ${vy*30 + 200}px) rotate(${rot}deg)`, opacity:0 }
                ], {duration:1200+Math.random()*800,easing:'cubic-bezier(.2,.8,.3,1)'});
                setTimeout(()=> d.remove(), 2200);
            }
        }

        function openGift(){
            gift.animate([{transform:'scale(1)'},{transform:'scale(1.06)'},{transform:'scale(1)'}], {duration:900, easing:'ease-out'});
            letter.classList.add('show');
            setTimeout(()=> {
                note.classList.add('show');
                typeMessage();
                burstConfetti(innerWidth/2, innerHeight/2 - 120, 28);
            }, 600);
        }

        function closeNote(){
            note.classList.remove('show');
            typedEl.textContent = '';
        }

        openBtn.addEventListener('click', openGift);
        gift.addEventListener('click', openGift);
        surpriseBtn.addEventListener('click', ()=>{
            // small surprise: immediate confetti and note
            burstConfetti(Math.random()*innerWidth, Math.random()*innerHeight/2+80, 36);
            note.classList.add('show');
            typeMessage(18);
        });

        // typing logic with callback for extra confetti at end
        const message = "Hôm nay là 20/10 — chúc mừng Ngày Phụ nữ Việt Nam!\n\nChị Thu Hiếu ơi,\nchúc chị một ngày 20/10 thật trọn vẹn niềm vui và ấm áp yêu thương. Luôn mạnh khỏe, hạnh phúc và đặc biệt là phải vui vẻ, yêu đời mãi như bây giờ nha chị! Chị xứng đáng với tất cả những điều tốt đẹp nhất.";
        let typingId = null;
        function typeMessage(speed=30){
            cancelAnimationFrame(typingId);
            typedEl.textContent = '';
            let i = 0;
            function loop(){
                typedEl.textContent += message.charAt(i);
                i++;
                if(i < message.length){
                    typingId = setTimeout(loop, speed);
                } else {
                    // final burst
                    burstConfetti(innerWidth/2, innerHeight/2 - 160, 36);
                }
            }
            loop();
        }

        // close note on click outside or Esc
        document.addEventListener('click', (e)=>{
            if(!note.contains(e.target) && !gift.contains(e.target) && !openBtn.contains(e.target)){
                closeNote();
            }
        });
        window.addEventListener('keydown', e=> { if(e.key==='Escape') closeNote(); });

        // small accessibility: touch shows letter
        let touchTimer = null;
        document.addEventListener('touchstart', ()=>{ clearTimeout(touchTimer); touchTimer = setTimeout(()=>gift.click(), 220); }, {passive:true});
    </script>
</body>
</html>
